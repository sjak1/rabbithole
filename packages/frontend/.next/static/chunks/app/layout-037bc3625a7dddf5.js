(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{660:()=>{},5329:(e,r,t)=>{"use strict";t.d(r,{default:()=>N});var n=t(68225),s=t(59845),a=t(49140),c=t.n(a),i=t(33892),o=t(13273),l=t(50570),d=t(40242);let h=s.forwardRef((e,r)=>{let{className:t,children:s,...a}=e;return(0,n.jsxs)(l.bL,{ref:r,className:(0,d.cn)("relative overflow-hidden",t),...a,children:[(0,n.jsx)(l.LM,{className:"h-full w-full rounded-[inherit]",children:s}),(0,n.jsx)(u,{}),(0,n.jsx)(l.OK,{})]})});h.displayName=l.bL.displayName;let u=s.forwardRef((e,r)=>{let{className:t,orientation:s="vertical",...a}=e;return(0,n.jsx)(l.VM,{ref:r,orientation:s,className:(0,d.cn)("flex touch-none select-none transition-colors","vertical"===s&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===s&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...a,children:(0,n.jsx)(l.lr,{className:"relative flex-1 rounded-full bg-border"})})});u.displayName=l.VM.displayName;var f=t(69282),m=t(31335),x=t(45529),b=t(78074),p=t(63233),g=t(24676),y=t(46415),v=t(24024),w=t(82869),j=t(26402);function N(){let{loadBranches:e,branchTitles:r}=(0,i.P)(),{isSidebarOpen:t,toggleSidebar:a}=(0,j.n)(),l=(0,o.usePathname)();(0,s.useEffect)(()=>{e()},[e]);let u=Object.entries(r);return(0,n.jsxs)("aside",{className:(0,d.cn)("flex flex-col fixed inset-y-0 z-40 bg-white border-r border-zinc-200 transition-all duration-300 ease-in-out",t?"w-64":"w-20"),children:[(0,n.jsxs)("div",{className:(0,d.cn)("p-4 border-b border-zinc-200 flex items-center",t?"justify-between":"justify-center"),children:[t&&(0,n.jsxs)(c(),{href:"/",className:"flex items-center gap-2 group",children:[(0,n.jsx)("div",{className:"w-8 h-8 flex items-center justify-center bg-zinc-900 rounded-lg",children:(0,n.jsx)(f.A,{className:"w-5 h-5 text-white"})}),(0,n.jsx)("span",{className:"text-lg font-semibold text-zinc-900",children:"Rabbithole"})]}),(0,n.jsx)(w.$,{variant:"ghost",size:"icon",onClick:a,className:"text-zinc-500 hover:text-zinc-900 group",children:t?(0,n.jsx)(m.A,{size:20}):(0,n.jsxs)("div",{className:"w-8 h-8 flex items-center justify-center bg-zinc-900 rounded-lg group-hover:bg-zinc-800 transition-colors",children:[(0,n.jsx)(f.A,{className:"w-5 h-5 text-white block group-hover:hidden"}),(0,n.jsx)(x.A,{className:"w-5 h-5 text-white hidden group-hover:block"})]})})]}),(0,n.jsxs)(y.iB,{children:[(0,n.jsxs)("div",{className:"p-4 space-y-2",children:[(0,n.jsxs)(c(),{href:"/",className:(0,d.cn)("flex items-center justify-center gap-2 w-full px-4 py-2 text-sm font-medium text-white bg-zinc-900 rounded-md hover:bg-zinc-800 transition-colors",!t&&"px-2"),children:[(0,n.jsx)(b.A,{size:16}),t&&"New Chat"]}),(0,n.jsxs)(c(),{href:"/flow",className:(0,d.cn)("flex items-center justify-center gap-2 w-full px-4 py-2 text-sm font-medium text-zinc-600 bg-zinc-100 rounded-md hover:bg-zinc-200 transition-colors",!t&&"px-2"),children:[(0,n.jsx)(p.A,{size:16}),t&&"View Flow"]})]}),t&&(0,n.jsx)(h,{className:"flex-1",children:(0,n.jsxs)("nav",{className:"px-4 pb-4",children:[(0,n.jsx)("p",{className:"px-4 py-2 text-xs font-semibold text-zinc-500 uppercase tracking-wider",children:"Chats"}),(0,n.jsx)("ul",{className:"space-y-1",children:u.map(e=>{let[r,t]=e,s=l==="/branch/".concat(r);return(0,n.jsx)("li",{children:(0,n.jsx)(c(),{href:"/branch/".concat(r),className:(0,d.cn)("block w-full text-left px-4 py-2 text-sm rounded-md truncate transition-colors",s?"bg-zinc-200 text-zinc-900 font-semibold":"text-zinc-600 hover:bg-zinc-100 hover:text-zinc-900"),children:t})},r)})})]})})]}),(0,n.jsx)(y.Bl,{children:(0,n.jsx)("div",{className:"flex-1 flex flex-col items-center justify-center p-4",children:(0,n.jsxs)("div",{className:"text-center space-y-4",children:[(0,n.jsx)(g.A,{className:"w-12 h-12 text-zinc-400 mx-auto"}),t&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("h3",{className:"text-sm font-medium text-zinc-900",children:"Welcome to Rabbithole"}),(0,n.jsx)("p",{className:"text-xs text-zinc-500",children:"Sign in to start chatting and explore different conversation paths"})]}),(0,n.jsx)(v.hZ,{children:(0,n.jsx)(w.$,{size:"sm",className:"w-full",children:"Sign In"})})]})]})})})]})}},8831:(e,r,t)=>{"use strict";t.d(r,{FB:()=>a,Ho:()=>i,KS:()=>d,SN:()=>o,VL:()=>s,lY:()=>u,p9:()=>f,rJ:()=>m,tz:()=>c,wz:()=>h,xh:()=>l});let n="http://localhost:4000",s=async e=>{try{let r=await fetch("".concat(n,"/messages/").concat(e),{credentials:"include"});if(!r.ok)throw Error("Failed to fetch messages");return r.json()}catch(e){return console.error("Error fetching messages:",e),[]}},a=async(e,r)=>{try{let t=await fetch("".concat(n,"/messages/").concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:r}),credentials:"include"});if(!t.ok)throw Error("Failed to set messages");return t.json()}catch(e){throw console.error("Error setting messages:",e),e}},c=async(e,r)=>{try{if(!(await fetch("".concat(n,"/parent/").concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({childId:e,parentId:r}),credentials:"include"})).ok)throw Error("Failed to set branch parent")}catch(e){throw console.error("Error setting branch parent:",e),e}},i=async e=>{try{let r=await fetch("".concat(n,"/parent/").concat(e),{credentials:"include"});if(!r.ok)throw Error("Failed to fetch branch parent");return r.json()}catch(e){throw console.error("Error fetching branch parent:",e),e}},o=async e=>{try{if(!(await fetch("".concat(n,"/branch/").concat(e),{method:"DELETE",credentials:"include"})).ok)throw Error("Failed to delete branch")}catch(e){throw console.error("Error deleting the branch:",e),e}},l=async(e,r)=>{try{if(!(await fetch("".concat(n,"/title/").concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:r}),credentials:"include"})).ok)throw Error("Failed to set branch title")}catch(e){throw console.error("Error setting branch title:",e),e}},d=async e=>{try{let r=await fetch("".concat(n,"/title/generate/").concat(e),{method:"POST",credentials:"include"});if(!r.ok)throw Error("Failed to generate title");let t=await r.json();return{title:t.updatedBranch.name,credits:t.remainingCredits}}catch(e){throw console.error("Error generating title:",e),e}},h=async()=>{try{let e=await fetch("".concat(n,"/api/user"),{credentials:"include"});if(!e.ok)throw Error("Failed to fetch user");return e.json()}catch(e){return console.error("Error fetching user:",e),null}},u=async function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"New Branch";try{if(!(await fetch("".concat(n,"/branch"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({branchId:e,name:r}),credentials:"include"})).ok)throw Error("Failed to create branch")}catch(e){throw console.error("Error creating branch:",e),e}},f=async()=>{try{let e=await fetch("".concat(n,"/branches"),{credentials:"include"});if(!e.ok)throw Error("Failed to fetch branches");return e.json()}catch(e){return console.error("Error fetching branches:",e),[]}},m=async(e,r)=>new Promise((t,s)=>{fetch("".concat(n,"/api/llm"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:e}),credentials:"include"}).then(e=>{var n;if(!e.ok)throw Error("Failed to fetch LLM response");let a=null==(n=e.body)?void 0:n.getReader(),c=new TextDecoder,i="";if(!a)throw Error("No reader available");(async()=>{try{for(;;){let{done:e,value:n}=await a.read();if(e)break;for(let e of c.decode(n,{stream:!0}).split("\n"))if(e.startsWith("data: "))try{let n=JSON.parse(e.slice(6));if("content"===n.type)i+=n.content,r(i);else if("complete"===n.type)return void t({content:i,credits:n.credits});else if("error"===n.type)return void s(Error(n.error))}catch(e){}}}catch(e){s(e)}})()}).catch(e=>{console.error("Error fetching LLM response:",e),s(e)})})},26402:(e,r,t)=>{"use strict";t.d(r,{n:()=>n});let n=(0,t(94257).v)(e=>({isSidebarOpen:!0,toggleSidebar:()=>e(e=>({isSidebarOpen:!e.isSidebarOpen}))}))},33892:(e,r,t)=>{"use strict";t.d(r,{P:()=>c});var n=t(94257),s=t(97433),a=t(8831);let c=(0,n.v)()((0,s.Zr)((e,r)=>({messagesByBranch:{},branchParents:{},branchTitles:{},credits:0,user:null,getMessagesForBranch:async r=>{let t=await (0,a.VL)(r);return e(e=>({messagesByBranch:{...e.messagesByBranch,[r]:t}})),t},addMessageToBranch:async(r,t)=>{let n=await (0,a.FB)(r,t);return e(e=>({messagesByBranch:{...e.messagesByBranch,[r]:n}})),n},setBranchParent:async(r,t)=>{await (0,a.tz)(r,t),e(e=>({branchParents:{...e.branchParents,[r]:t}}))},getBranchParent:async r=>{let t=await (0,a.Ho)(r);return t&&e(e=>({branchParents:{...e.branchParents,[r]:t.id}})),(null==t?void 0:t.id)||null},setBranchTitle:async(r,t)=>{await (0,a.xh)(r,t),e(e=>({branchTitles:{...e.branchTitles,[r]:t}}))},getBranchTitle:e=>r().branchTitles[e]||null,deleteBranch:async r=>{await (0,a.SN)(r),e(e=>{let{[r]:t,...n}=e.messagesByBranch,{[r]:s,...a}=e.branchParents,{[r]:c,...i}=e.branchTitles;return{messagesByBranch:n,branchParents:a,branchTitles:i}})},createBranch:async(e,r)=>{await (0,a.lY)(e,r)},loadBranches:async()=>{let r=await (0,a.p9)();e(()=>{let e={},t={},n={};return r.forEach(r=>{var s;e[r.id]=null!=(s=r.messages)?s:[],r.parentId&&(t[r.id]=r.parentId),n[r.id]=r.name}),{messagesByBranch:e,branchParents:t,branchTitles:n}})},setCredits:r=>{e(()=>({credits:r}))},loadUser:async()=>{let r=await (0,a.wz)();e(()=>({user:r,credits:(null==r?void 0:r.credits)||0}))}}),{name:"chat-storage",skipHydration:!0}))},40242:(e,r,t)=>{"use strict";t.d(r,{cn:()=>a});var n=t(54407),s=t(86955);function a(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,s.QP)((0,n.$)(r))}},52161:(e,r,t)=>{"use strict";t.d(r,{default:()=>m});var n=t(68225),s=t(26402),a=t(40242),c=t(33892),i=t(13273),o=t(46415),l=t(24024);t(59845);let d=(0,t(51151).F)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function h(e){let{className:r,variant:t,...s}=e;return(0,n.jsx)("div",{className:(0,a.cn)(d({variant:t}),r),...s})}var u=t(82869);function f(){let{branchTitles:e,credits:r}=(0,c.P)(),t=(0,i.usePathname)().split("/").pop(),s=t?e[t]:"New Chat",a=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:4}).format(r);return(0,n.jsxs)("header",{className:"flex items-center justify-between p-4 bg-white border-b border-zinc-200",children:[(0,n.jsx)("h1",{className:"text-lg font-semibold text-zinc-900 truncate",children:s}),(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsxs)(o.iB,{children:[(0,n.jsxs)(h,{variant:"outline",className:"text-sm font-mono",children:["Credits: ",a]}),(0,n.jsx)(l.uF,{})]}),(0,n.jsx)(o.Bl,{children:(0,n.jsx)(l.hZ,{mode:"modal",children:(0,n.jsx)(u.$,{children:"Sign In"})})})]})]})}function m(e){let{children:r}=e,{isSidebarOpen:t}=(0,s.n)();return(0,n.jsxs)("div",{className:(0,a.cn)("flex flex-col flex-1 h-screen transition-all duration-300 ease-in-out",t?"ml-64":"ml-20"),children:[(0,n.jsx)(f,{}),(0,n.jsx)("main",{className:"flex-1 overflow-y-auto p-6",children:r})]})}},52527:()=>{},64897:(e,r,t)=>{"use strict";t.d(r,{StoreInitializer:()=>c});var n=t(59845),s=t(33892),a=t(24024);function c(){let{loadUser:e}=(0,s.P)(),{isSignedIn:r}=(0,a.Jd)();return(0,n.useEffect)(()=>{s.P.persist.rehydrate()},[]),(0,n.useEffect)(()=>{r&&e()},[r,e]),null}},82869:(e,r,t)=>{"use strict";t.d(r,{$:()=>l});var n=t(68225),s=t(59845),a=t(5551),c=t(51151),i=t(40242);let o=(0,c.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),l=s.forwardRef((e,r)=>{let{className:t,variant:s,size:c,asChild:l=!1,...d}=e,h=l?a.DX:"button";return(0,n.jsx)(h,{className:(0,i.cn)(o({variant:s,size:c,className:t})),ref:r,...d})});l.displayName="Button"},96438:(e,r,t)=>{"use strict";t.d(r,{y:()=>s});var n=t(17003);let s=(0,n.createServerReference)("7f25e981ab207f67f120b8342f8cb7c7d8b5d83fd3",n.callServer,void 0,n.findSourceMapURL,"invalidateCacheAction")},99447:(e,r,t)=>{Promise.resolve().then(t.bind(t,80256)),Promise.resolve().then(t.bind(t,64425)),Promise.resolve().then(t.bind(t,70898)),Promise.resolve().then(t.bind(t,9149)),Promise.resolve().then(t.bind(t,66393)),Promise.resolve().then(t.bind(t,51109)),Promise.resolve().then(t.t.bind(t,52368,23)),Promise.resolve().then(t.t.bind(t,52527,23)),Promise.resolve().then(t.bind(t,52161)),Promise.resolve().then(t.bind(t,5329)),Promise.resolve().then(t.bind(t,64897))}},e=>{var r=r=>e(e.s=r);e.O(0,[309,816,747,558,651,927,518,358],()=>r(99447)),_N_E=e.O()}]);