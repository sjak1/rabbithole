(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[187],{8831:(e,t,r)=>{"use strict";r.d(t,{FB:()=>c,Ho:()=>s,KS:()=>h,SN:()=>i,VL:()=>n,lY:()=>f,p9:()=>u,rJ:()=>g,tz:()=>o,wz:()=>d,xh:()=>l});let a="http://localhost:4000",n=async e=>{try{let t=await fetch("".concat(a,"/messages/").concat(e),{credentials:"include"});if(!t.ok)throw Error("Failed to fetch messages");return t.json()}catch(e){return console.error("Error fetching messages:",e),[]}},c=async(e,t)=>{try{let r=await fetch("".concat(a,"/messages/").concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:t}),credentials:"include"});if(!r.ok)throw Error("Failed to set messages");return r.json()}catch(e){throw console.error("Error setting messages:",e),e}},o=async(e,t)=>{try{if(!(await fetch("".concat(a,"/parent/").concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({childId:e,parentId:t}),credentials:"include"})).ok)throw Error("Failed to set branch parent")}catch(e){throw console.error("Error setting branch parent:",e),e}},s=async e=>{try{let t=await fetch("".concat(a,"/parent/").concat(e),{credentials:"include"});if(!t.ok)throw Error("Failed to fetch branch parent");return t.json()}catch(e){throw console.error("Error fetching branch parent:",e),e}},i=async e=>{try{if(!(await fetch("".concat(a,"/branch/").concat(e),{method:"DELETE",credentials:"include"})).ok)throw Error("Failed to delete branch")}catch(e){throw console.error("Error deleting the branch:",e),e}},l=async(e,t)=>{try{if(!(await fetch("".concat(a,"/title/").concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:t}),credentials:"include"})).ok)throw Error("Failed to set branch title")}catch(e){throw console.error("Error setting branch title:",e),e}},h=async e=>{try{let t=await fetch("".concat(a,"/title/generate/").concat(e),{method:"POST",credentials:"include"});if(!t.ok)throw Error("Failed to generate title");let r=await t.json();return{title:r.updatedBranch.name,credits:r.remainingCredits}}catch(e){throw console.error("Error generating title:",e),e}},d=async()=>{try{let e=await fetch("".concat(a,"/api/user"),{credentials:"include"});if(!e.ok)throw Error("Failed to fetch user");return e.json()}catch(e){return console.error("Error fetching user:",e),null}},f=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"New Branch";try{if(!(await fetch("".concat(a,"/branch"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({branchId:e,name:t}),credentials:"include"})).ok)throw Error("Failed to create branch")}catch(e){throw console.error("Error creating branch:",e),e}},u=async()=>{try{let e=await fetch("".concat(a,"/branches"),{credentials:"include"});if(!e.ok)throw Error("Failed to fetch branches");return e.json()}catch(e){return console.error("Error fetching branches:",e),[]}},g=async(e,t)=>new Promise((r,n)=>{fetch("".concat(a,"/api/llm"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:e}),credentials:"include"}).then(e=>{var a;if(!e.ok)throw Error("Failed to fetch LLM response");let c=null==(a=e.body)?void 0:a.getReader(),o=new TextDecoder,s="";if(!c)throw Error("No reader available");(async()=>{try{for(;;){let{done:e,value:a}=await c.read();if(e)break;for(let e of o.decode(a,{stream:!0}).split("\n"))if(e.startsWith("data: "))try{let a=JSON.parse(e.slice(6));if("content"===a.type)s+=a.content,t(s);else if("complete"===a.type)return void r({content:s,credits:a.credits});else if("error"===a.type)return void n(Error(a.error))}catch(e){}}}catch(e){n(e)}})()}).catch(e=>{console.error("Error fetching LLM response:",e),n(e)})})},33892:(e,t,r)=>{"use strict";r.d(t,{P:()=>o});var a=r(94257),n=r(97433),c=r(8831);let o=(0,a.v)()((0,n.Zr)((e,t)=>({messagesByBranch:{},branchParents:{},branchTitles:{},credits:0,user:null,getMessagesForBranch:async t=>{let r=await (0,c.VL)(t);return e(e=>({messagesByBranch:{...e.messagesByBranch,[t]:r}})),r},addMessageToBranch:async(t,r)=>{let a=await (0,c.FB)(t,r);return e(e=>({messagesByBranch:{...e.messagesByBranch,[t]:a}})),a},setBranchParent:async(t,r)=>{await (0,c.tz)(t,r),e(e=>({branchParents:{...e.branchParents,[t]:r}}))},getBranchParent:async t=>{let r=await (0,c.Ho)(t);return r&&e(e=>({branchParents:{...e.branchParents,[t]:r.id}})),(null==r?void 0:r.id)||null},setBranchTitle:async(t,r)=>{await (0,c.xh)(t,r),e(e=>({branchTitles:{...e.branchTitles,[t]:r}}))},getBranchTitle:e=>t().branchTitles[e]||null,deleteBranch:async t=>{await (0,c.SN)(t),e(e=>{let{[t]:r,...a}=e.messagesByBranch,{[t]:n,...c}=e.branchParents,{[t]:o,...s}=e.branchTitles;return{messagesByBranch:a,branchParents:c,branchTitles:s}})},createBranch:async(e,t)=>{await (0,c.lY)(e,t)},loadBranches:async()=>{let t=await (0,c.p9)();e(()=>{let e={},r={},a={};return t.forEach(t=>{var n;e[t.id]=null!=(n=t.messages)?n:[],t.parentId&&(r[t.id]=t.parentId),a[t.id]=t.name}),{messagesByBranch:e,branchParents:r,branchTitles:a}})},setCredits:t=>{e(()=>({credits:t}))},loadUser:async()=>{let t=await (0,c.wz)();e(()=>({user:t,credits:(null==t?void 0:t.credits)||0}))}}),{name:"chat-storage",skipHydration:!0}))},80293:(e,t,r)=>{Promise.resolve().then(r.bind(r,89345))},89345:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});var a=r(68225),n=r(28571);r(87142);var c=r(33892),o=r(59845);function s(){let{messagesByBranch:e,branchParents:t,branchTitles:r,loadBranches:s}=(0,c.P)();(0,o.useEffect)(()=>{s().catch(console.error)},[s]);let i=(0,o.useMemo)(()=>{let a=Object.keys(e);if(0===a.length)return[];let n=new Map,c=new Set(a);for(let[e,r]of Object.entries(t))c.has(r)&&(n.has(r)||n.set(r,[]),n.get(r).push(e));let o=a.filter(e=>!t[e]),s=new Map,i=new Map;for(let e of a)!function e(t){if(i.has(t))return i.get(t);let r=n.get(t)||[];if(0===r.length)return i.set(t,250),250;let a=0;for(let t of r)a+=e(t);return i.set(t,a),a}(e);let l=0;for(let e of o)!function e(t,r,a){s.set(t,{x:r,y:a});let c=n.get(t)||[];if(0===c.length)return;let o=r-i.get(t)/2;for(let t of c){let r=i.get(t);e(t,o+r/2,a+150),o+=r}}(e,l,0),l+=i.get(e)+250;return a.map(e=>({id:e,position:s.get(e)||{x:0,y:0},data:{label:r[e]||"Branch ".concat(e.slice(0,4)),url:"/branch/".concat(e)},style:{background:"#f0f9ff",border:"2px solid #3b82f6",padding:"8px",borderRadius:"8px",width:180,textAlign:"center"}}))},[e,r,t]),l=(0,o.useMemo)(()=>Object.entries(t).map(e=>{let[t,r]=e;return{id:"".concat(r,"-").concat(t),source:r,target:t,type:"smoothstep"}}),[t]),[h,d,f]=(0,n.ck)(i),[u,g,y]=(0,n.fM)(l);return(0,o.useEffect)(()=>d(i),[i,d]),(0,o.useEffect)(()=>g(l),[l,g]),(0,a.jsx)("div",{className:"h-screen w-full",children:(0,a.jsxs)(n.Gc,{nodes:h,edges:u,onNodesChange:f,onEdgesChange:y,nodesDraggable:!0,fitView:!0,onNodeClick:(e,t)=>window.location.href=t.data.url,maxZoom:2,minZoom:.1,children:[(0,a.jsx)(n.H2,{}),(0,a.jsx)(n.of,{}),(0,a.jsx)(n.VS,{variant:n._5.Dots,gap:12,size:1})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[831,264,972,927,518,358],()=>t(80293)),_N_E=e.O()}]);